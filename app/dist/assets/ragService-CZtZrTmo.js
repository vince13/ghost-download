class a{constructor(){this.pineconeApiKey=null,this.pineconeIndex=null,this.pineconeClient=null,this.index=null}async initialize(n,e,o=null){if(this.pineconeApiKey=n,this.pineconeIndex=e,!n||!e){console.warn("[RAG] Pinecone not configured");return}console.log("[RAG] Pinecone configured (using API endpoints)")}async generateEmbedding(n){if(!n||typeof n!="string")throw new Error("Invalid text input for embedding");try{return console.warn("[RAG] Embedding API unavailable, using fallback embedding"),this.fallbackEmbedding(n)}catch(e){return console.error("[RAG] Embedding generation error:",e),this.fallbackEmbedding(n)}}fallbackEmbedding(n){const e=n.split("").reduce((o,r)=>(o<<5)-o+r.charCodeAt(0),0);return Array(384).fill(0).map((o,r)=>Math.sin(e+r)*.1)}chunkDocument(n,e=500,o=50){if(!n||typeof n!="string")return[];const r=n.split(/\s+/),t=[];for(let s=0;s<r.length;s+=e-o){const i=r.slice(s,s+e).join(" ");i.trim().length>0&&t.push({text:i,index:t.length,startWord:s,endWord:Math.min(s+e,r.length)})}return t}async storeDocument(n,e,o,r={}){if(!n||!e||!o)throw new Error("Missing required parameters for storeDocument");try{const t=this.chunkDocument(o);if(t.length===0)return console.warn("[RAG] No chunks generated from document"),{success:!1,chunks:0};console.log(`[RAG] Calling /api/store-document with ${t.length} chunks for document ${e}`);const s=await fetch("/api/store-document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:n,documentId:e,chunks:t.map(c=>c.text),metadata:{...r,documentId:e,chunkCount:t.length}})});if(!s.ok){const c=await s.json().catch(()=>({error:"Unknown error"}));throw console.error("[RAG] Store document API error:",c),new Error(c.error||`Failed to store document: ${s.status} ${s.statusText}`)}const i=await s.json();return console.log(`[RAG] âœ… Stored ${i.stored} chunks for document ${e} in Pinecone`),{success:!0,chunks:i.stored}}catch(t){throw console.error("[RAG] Error storing document:",t),t}}async retrieveContext(n,e,o=5){if(!n||!e)return null;try{const r=await fetch("/api/retrieve-rag",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:n,query:e,topK:o})});if(!r.ok)return console.warn("[RAG] RAG retrieval failed:",r.statusText),null;const{context:t}=await r.json();return t}catch(r){return console.error("[RAG] RAG retrieval error:",r),null}}async deleteDocument(n,e){if(!(!n||!e))try{(await fetch("/api/delete-document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:n,documentId:e})})).ok&&console.log(`[RAG] Deleted document ${e} from Pinecone`)}catch(o){console.error("[RAG] Error deleting document:",o)}}}const u=new a;export{a as RAGService,u as ragService};
